{% extends "base.html" %}

{% block content %}
<div class="container">
    {% include 'partials/breadcrumbs.html' %}

    <!-- NUEVO LAYOUT DE PÁGINA DE PRODUCTO -->
    <div class="product-detail-page">

        <!-- COLUMNA IZQUIERDA: INFORMACIÓN -->
        <div class="product-info-column">
            <h1>{{ product.name }}</h1>
            <p class="price">{{ product.price }}</p>
            <p class="meta">SKU: {{ product.sku }}<br>Category: {{ product.category.capitalize() }}</p>
            <p class="description">{{ product.description }}</p>

            <!-- Selector de colores (único selector ahora) -->
            <div class="option-selector" id="color-selector">
                <label>Color:</label>
                <div class="options">
                    {% for color, image_path in product.color_variants.items() %}
                    <button class="color-option" data-color="{{ color }}"
                        data-image-src="{{ url_for('static', filename=image_path) }}">
                        {{ color }}
                    </button>
                    {% endfor %}
                </div>
            </div>
            <!-- Selector de cantidad y botón de compra -->
            <div class="purchase-actions">
                <button class="purchase-button" id="add-to-cart-btn" data-product-id="{{ product.id }}" disabled>ADD TO
                    CART</button>
            </div>
            {% if is_in_wishlist %}
            <!-- Si el producto YA ESTÁ en la wishlist, mostramos el botón deshabilitado -->
            <a href="#" class="add-to-wishlist-btn disabled" data-product-id="{{ product.id }}">
                <i class="fa-solid fa-heart"></i>
                <span>Added to Wishlist</span>
            </a>
            {% else %}
            <!-- Si NO está, mostramos el botón normal para añadirlo -->
            <a href="#" class="add-to-wishlist-btn" data-product-id="{{ product.id }}">
                <i class="fa-regular fa-heart"></i>
                <span>Add to Wishlist</span>
            </a>
            {% endif %}
        </div>

        <!-- COLUMNA DERECHA: GALERÍA DE IMÁGENES (Con data-attributes) -->
        <div class="product-gallery-column">
            <div class="main-product-image">
                <!-- Usamos la imagen del primer color como imagen inicial -->
                <img src="{{ url_for('static', filename=product.color_variants.values()|first) }}"
                    alt="{{ product.name }}" id="main-product-image">
            </div>
            <div class="product-thumbnails">
                <!-- Hacemos un bucle sobre todas las imágenes de la galería -->
                {% for color, image_path in product.color_variants.items() %}
                <img class="thumbnail-img {{ 'active' if loop.first }}"
                    src="{{ url_for('static', filename=image_path) }}"
                    data-image-src="{{ url_for('static', filename=image_path) }}" data-color="{{ color }}" {# Le decimos
                    a la miniatura a qué color pertenece #} alt="Thumbnail of {{ product.name }} in {{ color }}">
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}