{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="account-page-layout">
        <!-- Sidebar (se mantiene consistente) -->
        <aside class="account-sidebar">
            <h2>MY ACCOUNT</h2>
            <nav class="account-nav">
                <ul>
                    <li><a href="{{ url_for('my_account_page') }}">Dashboard</a></li>
                    <li><a href="{{ url_for('my_account_orders') }}" class="active">Orders</a></li>
                    <li><a href="{{ url_for('my_account_downloads') }}">Downloads</a></li>
                    <li><a href="{{ url_for('my_account_details') }}">Account details</a></li>
                    <li><a href="{{ url_for('wishlist_page') }}">Wishlist</a></li>
                    <li><a href="{{ url_for('logout') }}">Log out</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Contenido Principal: Tabla de Pedidos -->
        <main class="account-content">
            <h2>Orders</h2>
            <table class="orders-table">
                <thead>
                    <tr>
                        <th>Order</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Total</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <!-- CORRECCIÓN: Usamos 'order.order_number' en lugar de 'order.number' -->
                        <td>#{{ order.order_number }}</td>
                        <!-- CORRECCIÓN: Formateamos la fecha desde el objeto datetime -->
                        <td>{{ order.date.strftime('%B %d, %Y') }}</td>
                        <td>{{ order.status }}</td>
                        <!-- CORRECCIÓN: Usamos 'order.items' para la longitud, ya que 'products' no existe en el modelo Order -->
                        <td>${{ "%.2f"|format(order.total) }} for {{ order.items|length }} item(s)</td>
                        <td>
                            <!-- CORRECCIÓN: Pasamos el 'order_number' a la ruta de vista -->
                            <a href="{{ url_for('view_order_page', order_number=order.order_number) }}"
                                class="orders-action-btn">View</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="no-orders-msg">
                            No order has been made yet. <a href="{{ url_for('home') }}" class="accent-link">Go
                                shopping</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </main>
    </div>
</div>
{% endblock %}