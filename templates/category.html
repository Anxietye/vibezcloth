{% extends "base.html" %}

{% block content %}
<div class="container">
    {% include 'partials/breadcrumbs.html' %}

    <div class="category-page-container">
        <!-- La nueva cuadrícula de productos -->
        <div class="category-product-grid">
            {% for product in products %}

            <a href="{{ url_for('product_detail', category_name=product.category, product_slug=product.slug) }}"
                class="product-card-link">
                <!-- Reutilizamos el estilo de tarjeta del index -->
                <div class="product-card-dark">
                    <div class="image-wrapper">
                        <!-- Usamos la primera imagen de las variantes de color -->
                        <img src="{{ url_for('static', filename=(product.color_variants.values()|first).image) }}"
                            alt="{{ product.name }}">
                    </div>
                    <div class="card-info">
                        <span class="category">{{ product.category.upper() }}</span>
                        <h3>{{ product.name }}</h3>
                        <p class="price">{{ product.price }}</p>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>

        {% if not products %}
        <p class="empty-category-msg">There are no products in this category yet.</p>
        {% endif %}


        <!-- =============================================== -->
        <!-- === INICIO DE LA SECCIÓN DE PAGINACIÓN AÑADIDA === -->
        <!-- =============================================== -->

        <!-- Solo mostramos la paginación si hay más de una página -->
        {% if total_pages > 1 %}
        <nav class="pagination-nav">
            <ul>
                <!-- Botón "Anterior" (solo si no es la primera página) -->
                {% if current_page > 1 %}
                <li><a href="{{ url_for('category_page', category_name=title|lower, page=current_page-1) }}">&laquo;
                        Prev</a></li>
                {% endif %}

                <!-- Números de Página -->
                {% for page_num in range(1, total_pages + 1) %}
                {% if page_num == current_page %}
                <li><span class="active">{{ page_num }}</span></li>
                {% else %}
                <li><a href="{{ url_for('category_page', category_name=title|lower, page=page_num) }}">{{ page_num
                        }}</a></li>
                {% endif %}
                {% endfor %}

                <!-- Botón "Siguiente" (solo si no es la última página) -->
                {% if current_page < total_pages %} <li><a
                        href="{{ url_for('category_page', category_name=title|lower, page=current_page+1) }}">Next
                        &raquo;</a></li>
                    {% endif %}
            </ul>
        </nav>
        {% endif %}

        <!-- =============================================== -->
        <!-- === FIN DE LA SECCIÓN DE PAGINACIÓN AÑADIDA === -->
        <!-- =============================================== -->


    </div> <!-- Cierre de .category-page-container -->
</div> <!-- Cierre de .container -->
{% endblock %}